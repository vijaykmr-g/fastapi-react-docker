version: "3.9"

services:
  backend:
    build:
      context: ./backend
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload  # âœ… enables auto reload
    volumes:
      - ./backend:/app      # âœ… syncs your local backend folder
      - /app/__pycache__    # âš ï¸ avoid overwriting Python cache files
    environment:
      - PYTHONDONTWRITEBYTECODE=1         # ğŸš« prevent .pyc creation conflicts
      - PYTHONUNBUFFERED=1                # âœ… ensures logs are visible live
    ports:
      - "8000:8000"         # backend accessible at localhost:8000
    networks:
      - app-network
    restart: always

  frontend:
    build:
      context: ./frontend
    command: npm start -- --host 0.0.0.0  # âœ… runs React dev server
    environment:
      - CHOKIDAR_USEPOLLING=true          # ğŸ‘€ ensures file watcher works inside Docker
      - WATCHPACK_POLLING=true            # ğŸ§© extra watcher for newer React setups
    volumes:
      - ./frontend:/app                   # âœ… sync local frontend folder
      - /app/node_modules                 # ğŸš€ prevent overwriting node_modules
      - /app/build                        # âš ï¸ avoid replacing React build folder
    ports:
      - "3000:3000"                       # frontend accessible at localhost:3000
    networks:
      - app-network
    depends_on:
      - backend                           # ensures backend starts first
    restart: always                       # ğŸ”„ auto-restart on crash

networks:
  app-network:
    driver: bridge
